# パッチ適用ガイド (patch.md)

## 1. 概要

本システムでは、PaperMCのソースコードに対する変更を`.patch`ファイルとして管理します。これにより、バージョンごとの変更点を明確に分離し、体系的な適用を可能にします。

## 2. パッチファイルの形式

パッチファイルは、標準的な`unified diff`形式（`.patch`拡張子）とします。これらのファイルは`git diff`コマンドによって生成されます。

## 3. パッチのディレクトリ構造

すべてのパッチは、プロジェクトルートの`patches`ディレクトリ内に、対象となるMinecraftのバージョンごとのサブディレクトリに格納します。

パッチファイル名は、適用順序を示すための連番と、変更内容を要約した説明的な名前で構成されます。

```
patches/
└── <minecraft_version>/
    ├── 0001-Implement-custom-API-hooks.patch
    ├── 0002-Optimize-entity-tracking.patch
    └── ...
```

- **`<minecraft_version>`**: `1.19.4`, `1.20.1`などのバージョン番号。
- **`NNNN-`**: 4桁のゼロ埋めされた連番。パッチはこの番号順に適用されます。

## 4. パッチ適用ワークフロー

`patcher`モジュールは、以下の手順でパッチを適用します。

1.  ユーザーが指定したバージョンのPaperMCソースコードを準備します（例: Gitリポジトリをクローンし、適切なタグをチェックアウトする）。
2.  `patches/<minecraft_version>`ディレクトリを特定します。
3.  ディレクトリ内の`.patch`ファイルをファイル名の昇順でソートします。
4.  ソートされた順序に従い、`git apply`コマンドを使用して各パッチを順番に適用します。
5.  いずれかのパッチ適用に失敗した場合、プロセスを中断し、エラーを報告します。

## 5. 新規パッチの作成方法

1.  変更を加えたいバージョンのクリーンなPaperMCソースコードを用意します。
2.  ソースコードに必要な変更を加えます。
3.  変更したファイルを`git add`でステージングします。
4.  以下のコマンドを実行して、`diff`をパッチファイルとして出力します。
    ```bash
    git diff --staged > ../patches/<minecraft_version>/NNNN-your-patch-description.patch
    ```
5.  作業ディレクトリをクリーンな状態に戻します（例: `git reset --hard`）。
